package com.bo.ad {	import flash.events.IOErrorEvent;	import flash.events.Event;	import flash.system.Security;	import flash.display.Loader;	import flash.net.URLRequest;	import com.bo.events.MyEvent;	import flash.display.Sprite;	import flash.utils.Timer;	import flash.events.TimerEvent;	import flash.text.TextField;	import flash.net.URLLoader;	import flash.events.MouseEvent;	public class HDTAds{		private var ld:Loader;		private var sp:Sprite;		private var _timer:Timer;		private var _timer_txt:TextField=new TextField();		private var con:*;		private var btnclose:ClsButton=new ClsButton();		public function HDTAds() {			//loadAd("static.acs86.com","http://static.acs86.com/player/RollPlayer.swf?aid=74877&t="+Math.random());						loadAd("*","http://iv.ra.icast.cn/iv/framework.swf?pos_id=5071");			//loadAd("*","http://labs.ra.icast.cn/v/framework.swf?pos_id=123&t="+Math.random());		}		public function rearrange(isFull:Boolean){		}		private function loadAd(hostName:String,url:String):void{			Security.allowDomain(hostName);			ld=new Loader();			ld.load(new URLRequest(url));			ld.contentLoaderInfo.addEventListener(Event.COMPLETE,onAdInit);			ld.contentLoaderInfo.addEventListener(IOErrorEvent.IO_ERROR,onAdError);		}		private function onAdError(evt:IOErrorEvent):void{			//Global.main.loadplayer();			ld.contentLoaderInfo.removeEventListener(Event.COMPLETE,onAdInit);			ld.contentLoaderInfo.removeEventListener(IOErrorEvent.IO_ERROR,onAdError);			Global.notificationCenter.postEvent(new MyEvent(MyEvent.POSTEVENT,MyEvent.PREADCOMPLETE));		}		private function onAdInit(evt:Event):void{			ld.contentLoaderInfo.removeEventListener(Event.COMPLETE,onAdInit);			ld.contentLoaderInfo.removeEventListener(IOErrorEvent.IO_ERROR,onAdError);			trace('onAdInit');			sp=new Sprite();			sp.graphics.beginFill(0x000000,1);			sp.graphics.drawRect(0,0,Global.appWidth,Global.appHeight-32);			sp.graphics.endFill();			Global.main.addChild(sp);			Global.main.showLoading();			con=ld.content;			con.addEventListener("AD_END",onAdComplete);			con.addEventListener("AD_NULL",onAdComplete);			con.addEventListener("AD_CLICK",onAdComplete);			con.addEventListener("AD_START",onAdStart);						//con.setSize(Global.appWidth,Global.appHeight-29);			//Global.main.addChild(ld);			sp.addChild(ld);		}		private function onTimer(evt:TimerEvent):void{			var dur:int=int(con.doCmd("getAdFullTime"));			var nowtime:int=int(con.doCmd("getAdPlayTime"));			_timer_txt.text="广告还剩："+int(dur-nowtime).toString()+"秒";			if(_timer.currentCount==5){				btnclose.x=Global.appWidth-btnclose.width-20;				btnclose.y=30;				btnclose.addEventListener(MouseEvent.CLICK,onclose);				sp.addChild(btnclose);			}		}		private function onTimerComplete(evt:TimerEvent):void{			//onAdComplete(null);		}		private function onAdStart(evt:Event):void{			//此处调用统计代码			con.doCmd("setSize",{width:Global.appWidth,height:Global.appHeight-32});			var urlloader:URLLoader=new URLLoader();			Global.main.hideLoading();			urlloader.load(new URLRequest(Global.adParameter.preAdLink));			_timer=new Timer(1000,int(con.doCmd("getAdFullTime")));			_timer.addEventListener(TimerEvent.TIMER,onTimer);			_timer.addEventListener(TimerEvent.TIMER_COMPLETE,onTimerComplete);			_timer.start();			_timer_txt.width=100;			_timer_txt.textColor=0xffffff;			_timer_txt.x=Global.appWidth-_timer_txt.width-10;			_timer_txt.y=10;			sp.addChild(_timer_txt);		}		public function myunload():void{		}		private function onclose(evt:MouseEvent):void{			onAdComplete(evt);		}		private function onAdComplete(evt:Event):void{			trace('ad is over');			if(_timer){				_timer.reset();				_timer=null;				sp.removeChild(_timer_txt);				sp.removeChild(btnclose);			}			sp.removeChild(ld);			Global.main.removeChild(sp);			//Global.main.removeChild(ld);			ld.removeEventListener("show_end",onAdComplete);			ld.removeEventListener("ad_none",onAdComplete);			ld.removeEventListener("load_failed",onAdComplete);			ld.removeEventListener("show_start",onAdStart);			con.doCmd("unLoadAd");			ld.unloadAndStop();			Global.main.loadplayer();			//Global.notificationCenter.postEvent(new MyEvent(MyEvent.POSTEVENT,MyEvent.PREADCOMPLETE));			//Global.main.loadplayer();		}	}	}