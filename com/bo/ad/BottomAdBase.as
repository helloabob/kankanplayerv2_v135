package com.bo.ad {	import flash.display.Sprite;	import flash.events.Event;	import flash.text.TextField;	import flash.text.TextFormat;	import flash.text.TextFormatAlign;	import flash.display.SimpleButton;	import flash.filters.DropShadowFilter;	import flash.display.Loader;	import flash.events.MouseEvent;	import flash.net.URLRequest;	import flash.system.System;	import flash.utils.ByteArray;		public class BottomAdBase extends Sprite{		private var adtype:int=2;  //0文字  1图片  2图文		private var txt:TextField;  //广告内容		private var tf:TextFormat=new TextFormat();		private var imageld:Loader;		private var clsbutton:SimpleButton;		private var tfshadow:DropShadowFilter=new DropShadowFilter(4,45);		private var back:Sprite=new Bottomback();		private var backwidth:int=400;		private var backheight:int=66;		private var backalpha:Number=0.8;   //背景颜色透明度		private var xml:XML;		public function BottomAdBase() {			// constructor code		}		public function initAndShow(adxmlindex:int):void{						var tt:int=-1;			var cc:int=0;			while(tt<adxmlindex){				if(Global.adParameter.adxml.chan[cc+1].t!="non")tt++;				cc++;			}			trace("tt:"+tt);			xml=Global.adParameter.adxml.chan[cc];						//xml=Global.adParameter.adxml.chan[adxmlindex+1];			back.alpha=xml.transparency/100;			back.width=backwidth;			back.height=backheight;			addChild(back);						/*if(adxmlindex==0)adtype=2;			else if(adxmlindex==1)adtype=1;			else adtype=0;*/			if(xml.t=="Illustrated")adtype=2;			else if(xml.t=="patchimg")adtype=1;			else adtype=0;			con();						clsbutton=new ClsButton();			clsbutton.x=backwidth-clsbutton.width-5;			clsbutton.y=5;			clsbutton.addEventListener(MouseEvent.CLICK,onHide);			addChild(clsbutton);		}		private function onHide(evt:MouseEvent):void{			evt.stopImmediatePropagation();			dispatchEvent(new Event("close"));		}		private function con():void{			if(adtype==0){				txt=new TextField();				txt.selectable=false;				txt.textColor=0xffffff;				tf.align=TextFormatAlign.CENTER;				txt.setTextFormat(tf);				txt.defaultTextFormat=tf;				txt.filters=[tfshadow];				txt.text=xml.texttitle;				txt.width=backwidth;				txt.height=backheight;				txt.x=width/2-txt.width/2;				txt.y=height/2-txt.height/2;				txt.wordWrap=true;				addChild(txt);			}else if(adtype==1){				imageld=new Loader();				imageld.contentLoaderInfo.addEventListener(Event.COMPLETE,onImageComplete);				imageld.load(new URLRequest(xml.parts.part.s));				addChild(imageld);			}else if(adtype==2){				imageld=new Loader();				imageld.contentLoaderInfo.addEventListener(Event.COMPLETE,onImageComplete);				imageld.load(new URLRequest(xml.parts.part.s));				addChild(imageld);			}		}		private function onImageComplete(evt:Event):void{			if(adtype==1)imageld.width=400;						imageld.height=66;			if(adtype==2){				imageld.width=88;				txt=new TextField();				txt.selectable=false;				txt.textColor=0xffffff;				tf.align=TextFormatAlign.LEFT;				txt.setTextFormat(tf);				txt.defaultTextFormat=tf;				txt.filters=[tfshadow];				txt.text=xml.texttitle;				//var byte:ByteArray=new ByteArray();				//var ss:String=xml.texttitle;				//byte.writeMultiByte(ss,"utf8");				//byte.position=0;				//var res:String="";				//var res:String=byte.readMultiByte(byte.length,"gbk");				//for(var i:int=0;i<byte.length;i++){					//res+=String.fromCharCode(byte[i]);				//}				//txt.text=res;				txt.width=width-imageld.width-20;				txt.height=backheight;				txt.x=imageld.width;				txt.wordWrap=true;				//txt.x=(width-imageld.width)/2-txt.width/2;				txt.y=height/2-txt.height/2;				addChild(txt);			}		}	}	}