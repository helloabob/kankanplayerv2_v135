package com.bo.ad {	import flash.events.IOErrorEvent;	import flash.events.Event;	import flash.system.Security;	import flash.display.Loader;	import flash.net.URLRequest;	import com.bo.events.MyEvent;	import flash.display.Sprite;	import flash.utils.Timer;	import flash.events.TimerEvent;	import flash.text.TextField;	import flash.net.URLLoader;	import flash.events.MouseEvent;	import flash.media.SoundMixer;	public class SmartMediaAds{		private var ld:Loader;		private var sp:Sprite;		private var _timer:Timer;		private var _timer_txt:TextField=new TextField();		private var con:*;		private var btnclose:ClsButton=new ClsButton();		private var checktimer:Timer=new Timer(10000,1);		private var isplay:Boolean=false;		public function SmartMediaAds() {			//loadAd("static.acs86.com","http://static.acs86.com/player/RollPlayer.swf?aid=74877&t="+Math.random());			loadAd("www.smartcreative.cn","http://www.smartcreative.cn/test/bit/embedPlayer/adPlayer.swf?au=http%3A%2F%2Fsmartmedia.allyes.com%2Fmain%2Fs%3Fdb%3Dsmartmedia%26border%3D0%26local%3Dxml&aid=smgbb|inpage|patch&hc=0&hs=0&alt=10&aw=580&ah=435&ast=15&azt=b&at=b&t="+ int(Math.random() * 100000000));		}		public function rearrange(isFull:Boolean){		}		private function loadAd(hostName:String,url:String):void{			Security.allowDomain(hostName);			ld=new Loader();			ld.load(new URLRequest(url));			ld.contentLoaderInfo.addEventListener(Event.COMPLETE,onAdInit);			ld.contentLoaderInfo.addEventListener(IOErrorEvent.IO_ERROR,onAdError);		}		private function onAdError(evt:IOErrorEvent):void{			//Global.main.loadplayer();			ld.contentLoaderInfo.removeEventListener(Event.COMPLETE,onAdInit);			ld.contentLoaderInfo.removeEventListener(IOErrorEvent.IO_ERROR,onAdError);			Global.notificationCenter.postEvent(new MyEvent(MyEvent.POSTEVENT,MyEvent.PREADCOMPLETE));		}		private function onAdInit(evt:Event):void{			ld.contentLoaderInfo.removeEventListener(Event.COMPLETE,onAdInit);			ld.contentLoaderInfo.removeEventListener(IOErrorEvent.IO_ERROR,onAdError);			trace('smartmedia_onAdInit');			checktimer.addEventListener(TimerEvent.TIMER_COMPLETE,onchecktimercomplete);			checktimer.start();			sp=new Sprite();			sp.graphics.beginFill(0x000000,1);			sp.graphics.drawRect(0,0,Global.appWidth,Global.appHeight-32);			sp.graphics.endFill();			Global.main.addChild(sp);			Global.main.showLoading();			con=ld.content;			con.addEventListener("ad_init",onAdSelfInit);			con.addEventListener("ad_show_end",onAdComplete);			con.addEventListener("ad_none",onAdComplete);			con.addEventListener("ad_load_failed",onAdComplete);			con.addEventListener("ad_show_start",onAdStart);			sp.addChild(ld);		}		private function onchecktimercomplete(evt:TimerEvent):void{			onAdComplete(null);		}		private function onAdSelfInit(evt:Event):void{			trace("ad_self_init_event");		}		private function onTimer(evt:TimerEvent):void{			_timer_txt.text="广告还剩："+int((con.duration-con.time)).toString()+"秒";			if(_timer.currentCount==5){				btnclose.x=Global.appWidth-btnclose.width-20;				btnclose.y=30;				btnclose.addEventListener(MouseEvent.CLICK,onclose);				sp.addChild(btnclose);			}		}		private function onTimerComplete(evt:TimerEvent):void{		}		private function onAdStart(evt:Event):void{			trace('ad_start');			checktimer.reset();			con.setSize(Global.appWidth,Global.appHeight-29);			con.setVolume(1);			//Global.main.addChild(ld);			if(SoundMixer.areSoundsInaccessible()){			SoundMixer.stopAll();			}else{				trace("inaccessible!!!!!");			}			//此处调用统计代码			var urlloader:URLLoader=new URLLoader();			urlloader.load(new URLRequest(Global.adParameter.preAdLink));			Global.main.hideLoading();			_timer=new Timer(1000,int(con.duration));			_timer.addEventListener(TimerEvent.TIMER,onTimer);			_timer.addEventListener(TimerEvent.TIMER_COMPLETE,onTimerComplete);			_timer.start();			_timer_txt.width=100;			_timer_txt.textColor=0xffffff;			_timer_txt.x=Global.appWidth-_timer_txt.width-10;			_timer_txt.y=10;			sp.addChild(_timer_txt);		}		public function myunload():void{		}		private function onclose(evt:MouseEvent):void{			onAdComplete(evt);		}		private function onAdComplete(evt:Event):void{			if(_timer){				_timer.reset();				_timer=null;				sp.removeChild(_timer_txt);				sp.removeChild(btnclose);			}			sp.removeChild(ld);			Global.main.removeChild(sp);			//Global.main.removeChild(ld);			ld.removeEventListener("ad_init",onAdComplete);			ld.removeEventListener("ad_show_end",onAdComplete);			ld.removeEventListener("ad_none",onAdComplete);			ld.removeEventListener("ad_load_failed",onAdComplete);			ld.removeEventListener("ad_show_start",onAdStart);			checktimer.reset();			if(checktimer.hasEventListener(TimerEvent.TIMER_COMPLETE))checktimer.removeEventListener(TimerEvent.TIMER_COMPLETE,onchecktimercomplete);			checktimer=null;			con.dispose();			//ld.unloadAndStop();			Global.main.loadplayer();			//Global.notificationCenter.postEvent(new MyEvent(MyEvent.POSTEVENT,MyEvent.PREADCOMPLETE));			//Global.main.loadplayer();		}	}	}