package com.bo.ad {	import com.bo.events.MyEvent;	import com.google.ads.instream.*;	import com.google.ads.instream.api.AdErrorEvent;	import com.google.ads.instream.api.AdEvent;	import com.google.ads.instream.api.AdsLoadedEvent;	import com.google.ads.instream.api.AdsLoader;	import com.google.ads.instream.api.AdsManager;	import com.google.ads.instream.api.AdsManagerTypes;	import com.google.ads.instream.api.AdsRequest;	import com.google.ads.instream.api.AdsRequestType;	import com.google.ads.instream.api.FlashAdsManager;	import com.google.ads.instream.api.VideoAdsManager;	import com.mvc.model.AdXmlModel;		import flash.display.InteractiveObject;	import flash.display.MovieClip;	import flash.display.Sprite;	import flash.events.TimerEvent;	import flash.media.Video;	import flash.net.URLLoader;	import flash.net.URLRequest;	import flash.text.TextField;	import flash.text.TextFormat;	import flash.utils.Timer;
	public class GoogleAds{		private var adsRequest:AdsRequest;		private var _adsManager:AdsManager;		private var _max:int=Global.playerparameter.adduration;		private var _timer:Timer=new Timer(1000,_max);		private var _type:uint=0;     //广告类型 0后贴  1前贴  2暂停  3浮层		private var _timer_txt:TextField=new TextField();		private var _tf:TextFormat=new TextFormat();		var mc:MovieClip=new MovieClip();		public function GoogleAds(type:uint=0) {			// constructor code			_type=type;			adsRequest=new AdsRequest();			// 必需参数			adsRequest.publisherId= "ca-video-pub-7531488000989118";			if(_type==3){				adsRequest.adSlotWidth=468;				adsRequest.adSlotHeight=300;				adsRequest.adType=AdsRequestType.OVERLAY;			}else{				adsRequest.adSlotWidth=336;				adsRequest.adSlotHeight=280;				adsRequest.adType = AdsRequestType.GRAPHICAL_FULL_SLOT;			}			adsRequest.language="zh";			adsRequest.adTest="off";			adsRequest.contentId = "kankanews-google-ad";						// 推荐参数			//adsRequest.channels = ["sports", "entertainment", "0123456789"];			//adsRequest.descriptionUrl = "http://www.example.com/description.htm";			//adsRequest.age = 1002;			//adsRequest.gender = 1;						// 可选参数			//adsRequest.adTest = "on";			//adsRequest.maxTotalAdDuration = 30000;			//adsRequest.minTotalAdDuration = 15000;			//adsRequest.uniqueAds = true;			//adsRequest.adTimePosition = 1;						// 准备广告载入器			var adsLoader:AdsLoader = new AdsLoader();			Global._stage.addChild(adsLoader);						// ADS_LOADED 用于广告成功返回的情况			// AD_ERROR 用于未针对该请求找到广告的情况			adsLoader.addEventListener(AdsLoadedEvent.ADS_LOADED, onAdsLoaded);			adsLoader.addEventListener(AdErrorEvent.AD_ERROR, onAdError);						// 请求广告			adsLoader.requestAds(adsRequest);		}		private function onPauseRequested(evt:AdEvent):void{					}		private function onResumeRequested(evt:AdEvent):void{					}		private function onVideoAdComplete(evt:AdEvent):void{					}		private function onVideoAdClicked(evt:AdEvent):void{					}		public function rearrange():void{			var flashAdsManager:FlashAdsManager = _adsManager as FlashAdsManager;			if(_type==0||_type==1||_type==2){				flashAdsManager.x=Global.appWidth/2-336/2;				flashAdsManager.y=(Global.appHeight-32)/2-280/2;			}else if(_type==3){				flashAdsManager.x=Global.appWidth/2-468/2;				flashAdsManager.y=Global.appHeight-32-300;			}		}		private function onAdsLoaded(adsLoadedEvent:AdsLoadedEvent):void{			//adsLoader.removeEventListener(AdsLoadedEvent.ADS_LOADED, onAdsLoaded);			//adsLoader.removeEventListener(AdErrorEvent.AD_ERROR, onAdError);			// 获取 AdsManager			_adsManager = adsLoadedEvent.adsManager;			_adsManager.addEventListener(AdErrorEvent.AD_ERROR, onAdError);			// 侦听并响应要求您暂停/恢复运行的事件			_adsManager.addEventListener(AdEvent.CONTENT_PAUSE_REQUESTED, onPauseRequested);			_adsManager.addEventListener(AdEvent.CONTENT_RESUME_REQUESTED, onResumeRequested);			_adsManager.addEventListener(AdEvent.USER_CLOSE,onUserClose);			_adsManager.addEventListener(AdEvent.STARTED,onAdStarted);												// 检查载入的广告是否为视频或 flash 广告			if (_adsManager.type == AdsManagerTypes.VIDEO){				// 创建视频广告管理器。				var videoAdsManager:VideoAdsManager = _adsManager as VideoAdsManager;				// 设置要用以针对视频广告跟踪点击次数的视觉元素				//var sp:Sprite=new Sprite();				//videoAdsManager.clickTrackingElement=sp;				// 指定重要事件				videoAdsManager.addEventListener(AdEvent.COMPLETE, onVideoAdComplete);				//videoAdsManager.addEventListener(AdEvent.CLICK, onVideoAdClicked);				// 播放广告。				trace("=================video type===================");				var video:Video=new Video();				_adsManager.load(video);				_adsManager.play(video); 			}else if(_adsManager.type == AdsManagerTypes.FLASH){				// 创建 flash 广告管理系统。				trace("=================flash type===================");				var flashAdsManager:FlashAdsManager = _adsManager as FlashAdsManager;				// 播放广告。				//flashAdsManager.load();				//flashAdsManager.play();				if(_type==2){					Global._stage.addChild(mc);					flashAdsManager.load(mc);					flashAdsManager.play(mc);				}else{					Global._stage.addChild(mc);					flashAdsManager.load(mc);					flashAdsManager.play(mc);				}								if(_type==0||_type==1||_type==2){					flashAdsManager.x=Global.appWidth/2-336/2;					flashAdsManager.y=(Global.appHeight-32)/2-280/2;				}else if(_type==3){					flashAdsManager.x=Global.appWidth/2-468/2;					flashAdsManager.y=Global.appHeight-32-300;				}							}		}		private function onAdStarted(evt:AdEvent):void{						if(_type==0||_type==1){				trace("============ad_started01============");				_timer.addEventListener(TimerEvent.TIMER,onTimer);				_timer.addEventListener(TimerEvent.TIMER_COMPLETE,onTimerComplete);				_timer.start();				_timer_txt.width=180;				_timer_txt.textColor=0xffffff;				_timer_txt.x=Global.appWidth-_timer_txt.width-10;				_timer_txt.y=10;				Global.main.addChild(_timer_txt);			}else if(_type==2){				trace("============ad_started2============");				if(Global.mps.mediaPlayer.playing){					myunload();				}else{					var urlloader:URLLoader=new URLLoader();					urlloader.load(new URLRequest(Global.adParameter.pauseAdLink));				}			}else if(_type==3){				trace("============ad_started3============");				var urlloader1:URLLoader=new URLLoader();				urlloader1.load(new URLRequest(Global.adParameter.overlayAdLink));			}					}		//private function onAdComplete(evt:AdEvent):void{			//trace("===========ad_complete===========");		//}		private function onUserClose(evt:AdEvent):void{			trace("user_close_event");			//_adsManager.unload();			if(_type==0||_type==1||_type==2){				myunload();			}		}		private function onTimerComplete(evt:TimerEvent):void{			trace('onTimer12312312332131231312321');			//var flashAdsManager:FlashAdsManager=_adsManager as FlashAdsManager;			myunload();		}		private function onTimer(evt:TimerEvent):void{			_timer_txt.text="可关闭广告，广告还剩："+(_max-_timer.currentCount).toString()+"秒";		}		public function myunload():void{			if(_type==0||_type==1){				_timer.reset();				_timer=null;				Global.main.removeChild(_timer_txt);			}			if(_type!=2){				_adsManager.unload();			}else{				mc.visible=false;			}			if(_type==1){				Global.main.loadplayer();			}else if(_type==0){				Global.main.processendstatus();			}		}		public function showpauseads():void{			mc.visible=true;		}		private function onAdError(evt:AdErrorEvent):void{			trace("ad_error_call");			if(_type==1){				Global.notificationCenter.postEvent(new MyEvent(MyEvent.POSTEVENT,MyEvent.PREADCOMPLETE));			}		}	}}