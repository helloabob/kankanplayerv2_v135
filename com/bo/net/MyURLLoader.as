package com.bo.net{		//import com.bo.ad.AdPanel;	//import com.bo.events.AdEvent;		import flash.events.Event;	import flash.events.IOErrorEvent;	import flash.net.URLLoader;	import flash.net.URLRequest;	import flash.net.URLRequestMethod;	import flash.net.URLVariables;	import flash.system.Security;	import flash.display.Loader;	import flash.display.DisplayObject;	import com.bo.utils.XMLParser;	import flash.events.EventDispatcher;	/**	 * 	 * @author Administrator	 */	public class MyURLLoader extends EventDispatcher{		private var initPlayerURL:String="";		//private var adPanel:AdPanel;		private var ld:Loader;		/**		 * 		 */		public function MyURLLoader(){		}		/**		 * 		 */		public function loadxml():void{			var tmp:String;			if(Global.omsid!=""){				initPlayerURL="http://114.80.151.69/oms/share/get_video_url_xml.php?omsid="+Global.omsid;				initPlayer();			}else{				if(Global.xmlid.indexOf("/")==0){					tmp=Global.xmlid.substr(1);				}else{					tmp=Global.xmlid;				}				if(tmp.indexOf("xml/")>0){					initPlayerURL=Address.XMLBASEPATH+tmp+".xml?t="+  int(Math.random() * 100000000);					initPlayer();				}else if(tmp.indexOf(".mp3")>0){					//play sound					Global.paramType=1;					Global.videodata.videourl=tmp;					myEventDispatcher("playvideo");					//Global.setupPlayer();					//Global._smgbbplayer.initOSMF();				}else{					Global.paramType=2;					initPlayerURL="http://i.smgbb.cn/share/get_video_url_xml.php?id="+tmp;					initPlayer();				}			}		}		private function myEventDispatcher(eventType:String):void{			dispatchEvent(new Event(eventType));		}		/**		 * 		 */		public function initPlayer():void{			//Global.videodata.videourl="http://domhttp.kksmg.com/2012/03/22/h264_450k_mp4_SHDongFangTV20120322070841928740301121800_aac.mp4";			//Global.playtype=1;			//myEventDispatcher("playvideo");			trace(initPlayerURL);			var urlloader:URLLoader=new URLLoader();			var req:URLRequest=new URLRequest(initPlayerURL);			urlloader.addEventListener(Event.COMPLETE,onLoaderComplete);			urlloader.addEventListener(IOErrorEvent.IO_ERROR,onIOError);			urlloader.load(req);		}		private function onIOError(evt:IOErrorEvent):void{			evt.target.removeEventListener(IOErrorEvent.IO_ERROR,onIOError);			trace('io错误');		}		private function onLoaderComplete(evt:Event):void{			trace(evt.target.data);			evt.target.removeEventListener(Event.COMPLETE,onLoaderComplete);			if(Global.omsid!=""){				Global.videodata.videourl=new XML(evt.target.data).video.videourl;			}else{				if(Global.paramType==0){					XMLParser.parseXML(new XML(evt.target.data));				}else if(Global.paramType==2){					Global.videodata.videourl=new XML(evt.target.data).video.videourl;				}			}			if(Global.playerparameter.isAd=="true"){				var adld:URLLoader=new URLLoader();				adld.addEventListener(Event.COMPLETE,onAdComp);				adld.load(new URLRequest(Global.videodata.adurl));			}else{				myEventDispatcher("playvideo");			}						//var hhost:String=Global._xml.host;			//if(Global.paramType==0){			/*if(hhost.indexOf("finance.kankanews.com")>0){				loadAd("static.acs86.com","http://static.acs86.com/player/RollPlayer.swf?aid=74877&hc=1");			}else */			//if(hhost.indexOf("domestic.kankanews.com")>0){				//loadAd("www.kankanews.com","http://www.kankanews.com/flash/iMediaPreAdPlayer.swf?t="+Math.random());				/*Security.allowDomain("www.kankanews.com");				ld=new Loader();				ld.load(new URLRequest("http://www.kankanews.com/flash/iMediaPreAdPlayer.swf"));				ld.contentLoaderInfo.addEventListener(Event.COMPLETE,onAdInit);*/				//onLoadMovie();			/*}else{				if(Global._isAd=="true"||Global._isAd=="1"){					adPanel=new AdPanel();					adPanel.addEventListener(AdEvent.PLAYCOMPLETE,onAdPlayComplete);					adPanel.requestAdServer();					//state=1;				}else{					onLoadMovie();				}				}			}else if(Global.paramType==2){				Global.videodata.videourl=Global._xml.video.videourl;				Global.setupPlayer();				//Global._smgbbplayer.initOSMF();			}*/		}		private function onAdComp(evt:Event):void{			evt.target.removeEventListener(Event.COMPLETE,onAdComp);			//Global.videodata.		}		private function loadAd(hostName:String,url:String):void{			Security.allowDomain(hostName);			ld=new Loader();			ld.load(new URLRequest(url));			ld.contentLoaderInfo.addEventListener(Event.COMPLETE,onAdInit);			ld.contentLoaderInfo.addEventListener(IOErrorEvent.IO_ERROR,onAdError);		}		private function onAdError(evt:IOErrorEvent):void{			onLoadMovie();		}		private function onAdInit(evt:Event):void{			var con:*=ld.content;			con.addEventListener("show_end",onAdComplete);			con.addEventListener("ad_none",onAdComplete);			con.addEventListener("load_failed",onAdComplete);			con.setSize(Global.appWidth,Global.appHeight);			//Global._smgbbplayer.addChild(ld);		}		private function onAdComplete(evt:Event):void{			//Global._smgbbplayer.removeChild(ld);			ld.removeEventListener("show_end",onAdComplete);			ld.removeEventListener("ad_none",onAdComplete);			ld.removeEventListener("load_failed",onAdComplete);			ld.unloadAndStop();			onLoadMovie();		}		//private function onAdPlayComplete(evt:AdEvent):void{			//adPanel.removeEventListener(AdEvent.PLAYCOMPLETE,onAdPlayComplete);			//onLoadMovie();			//if(state==1)onLoadMovie();			//else if(state==3)fc1();		//}		private function onLoadMovie():void{			//var url_temp:String=Global._xml.filename;			var url_temp:String="";			//Global._url=getVideoUrl(url_temp);			//Global._title=Global._xml.title;			//var pu:String=Global._xml.host;			//if(pu.indexOf(".html")>0)pu=pu.substr(0,pu.lastIndexOf("."))+".shtml";			//Global._pageurl=pu;			//trace(url);			//Global._smgbbplayer.initOSMF();		}		private function getVideoUrl(url_temp:String):String{			var url:String="";			if(url_temp.indexOf("http://")>=0){				url=url_temp;			}else{				if(Global.protocolType=="rtmp"){					url="rtmp://sports.kksmg.com:80/vod/mp4:"+url_temp;   //RTMP路线				}else{					//var tmp:String=Global._xml.host;					var tmp:String=Global.videodata.host;					tmp=tmp.substring(tmp.indexOf("//")+2,tmp.indexOf("."));					var tmp2:String="";					if(tmp=="world"){						tmp2="world";					}else if(tmp=="finance"){						tmp2="fin";					}else if(tmp=="sports"){						tmp2="sport";					}else if(tmp=="society"){						tmp2="soc";					}else if(tmp=="ent"){						tmp2="ent";					}else if(tmp=="ipai"){						tmp2="ipai";					}else{						tmp2="dom";					}					url="http://"+tmp2+"http.kksmg.com"+url_temp;					Security.loadPolicyFile("http://"+tmp2+"http.kksmg.com/crossdomain.xml");				}							}			trace(url);			return url;		}		/*private function onLoaderComplete(evt:Event):void{			var res:String=evt.target.data;			//trace(res);			//res=res.replace("\/","/");			var filename=getValue(res,"stream");					var url0:String=getValue(res,"serverPath");			var i:int=url0.indexOf("vod")+5;			var p:String=url0.substring(0,i);			var o:String=url0.substring(i);			var result:String=p+"mp4:"+o+"/"+filename;			while(result.indexOf("\\/")>0){				result=result.replace("\\/","/");				}						Global._title=String(getValue(res,"sourcename"));			trace(Global._title);						Global._smgbbplayer.initOSMF(result);		}		*/	}}